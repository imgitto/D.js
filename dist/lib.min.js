const D={},__internal={};(e=>{const t=Symbol("CREATE_NODE"),n=Symbol("REMOVE_NODE"),r=Symbol("REPLACE_NODE"),l=Symbol("UPDATE_NODE"),o=Symbol("SET_PROP"),a=Symbol("REMOVE PROP"),s=Symbol("UPDATE_LISTENER_PROP"),p=Symbol("FRAGMENT_NODE");e.flatten=(e=>[].concat.apply([],e)),e.isNullOrUndefined=(e=>null==e),e.h=((t,n,...r)=>{switch(n=n||{},r=e.flatten(r),t){case D.If:case D.ForEach:case D.Switch:case D.Case:return t({props:n,children:r})}return{type:t,props:n,children:r}}),e.changed=(({newNode:e,oldNode:t})=>typeof e!=typeof t||["string","number","undefined"].includes(typeof e)&&e!==t||e.type!==t.type),e.diffProps=(({newNode:t,oldNode:n})=>{const r=[],l=Object.assign({},t.props,n.props);return Object.keys(l).forEach(l=>{const p=t.props[l],i=n.props[l];if(e.isNullOrUndefined(p))r.push({type:a,name:l,value:i});else if(l.startsWith("on-"))r.push({type:s,name:l,newValue:p,oldValue:i});else if("style"===l){let t=e.compareStyles({oldVal:i,newVal:p});null!==t&&r.push({type:o,name:l,value:t})}else(e.isNullOrUndefined(i)||p!==i)&&r.push({type:o,name:l,value:p})}),r}),e.compareStyles=(({oldVal:e,newVal:t})=>{if(Object.is(e,t))return null;let n={};return Object.keys(t).forEach(r=>{e[r]!==t[r]&&(n[r]=t[r])}),n}),e.diffChildren=(({newNode:t,oldNode:n})=>{const r=[],l=Math.max(t.children.length,n.children.length);for(let o=0;o<l;o++)r[o]=e.diff({newNode:t.children[o],oldNode:n.children[o]});return r}),e.propsChanged=(({newProps:e,oldProps:t})=>!Object.is(e,t)),e.diff=(({newNode:o,oldNode:a})=>{if(e.isNullOrUndefined(a))return{type:t,newNode:o};if(e.isNullOrUndefined(o))return{type:n,oldNode:a};if(e.changed({newNode:o,oldNode:a}))return null===a.type?{type:t,newNode:o}:null===o.type?{type:n,oldNode:a}:{type:r,newNode:o,oldNode:a};if("function"==typeof o.type)e.propsChanged({newProps:o.props,oldProps:a.props})&&a._internal.setProps(o.props),o._internal=a._internal;else if(null===o.type&&null===a.type)return null;return o.type?{type:l,isFragment:o.type===p,props:e.diffProps({newNode:o,oldNode:a}),children:e.diffChildren({newNode:o,oldNode:a})}:void 0}),e.createElement=(({node:t,parent:n})=>{if(["string","number","undefined"].includes(typeof t))return document.createTextNode(t);if(null===t.type)return null;if("function"==typeof t.type){if(t.type===D.If||t.type===D.ForEach){let r=t.type({props:t.props,children:t.children,parent:n});return Array.isArray(r)?(r.map(t=>e.createElement({node:t,parent:n})).forEach(e=>{null!==e&&n.appendChild(e)}),n):e.createElement({node:r,parent:n})}return t._internal=(new t.type)(t.props),t._internal.render(n)}if(t.type===p)return t.children.map(t=>e.createElement({node:t,parent:n}));const r=document.createElement(t.type);return e.setProps({target:r,props:t.props}),t.children.map(t=>e.createElement({node:t,parent:r})).forEach(t=>{Array.isArray(t)?t.forEach(e=>{r.appendChild(e)}):!1===e.isNullOrUndefined(t)&&r.appendChild(t)}),r}),e.setProp=(({target:t,name:n,value:r})=>{if("className"===n)return t.setAttribute("class",r);if(n.startsWith("on-")){let e=n.split("on-")[1];t.addEventListener(e,r)}else"value"===n?t.value=r:"style"===n?e.applyStyles({target:t,styles:r}):t.setAttribute(n,r)}),e.applyStyles=(({target:e,styles:t})=>{"object"==typeof t&&!1===Array.isArray(t)&&Object.keys(t).forEach(n=>{e.style[n]=t[n]})}),e.setProps=(({target:t,props:n})=>{Object.keys(n).forEach(r=>{e.setProp({target:t,name:r,value:n[r]})})}),e.removeProp=(({target:e,name:t,value:n})=>{if("className"===t)return e.removeAttribute("class");e.removeAttribute(t)}),e.updateListener=(({target:e,name:t,newValue:n,oldValue:r})=>{let l=t.split("on-")[1];e.removeEventListener(l,r),e.addEventListener(l,n)}),e.patchProps=(({parent:t,patches:n})=>{for(let r=0;r<n.length;r++){const l=n[r];l.type===s&&e.updateListener({target:t,name:l.name,newValue:l.newValue,oldValue:l.oldValue});const{type:p,name:i,value:c}=l;p===o&&e.setProp({target:t,name:i,value:c}),p===a&&e.removeProp({parent:target,name:i,value:c})}}),e.patch=(({parent:o,patches:a,index:s,level:p,adjustIndex:i})=>{if(!a||e.isNullOrUndefined(a))return;let c=o.childNodes[s+i[p]];switch(a.type){case t:{const{newNode:t}=a,n=e.createElement({node:t,parent:o});return o.insertBefore(n,o.children[s+i[p]])}case n:return"function"==typeof a.oldNode.type&&a.oldNode._internal.unmount(),i[p]+=-1,o.removeChild(c);case r:{const{newNode:t}=a,n=e.createElement({node:t,parent:o});return o.replaceChild(n,c)}case l:{c=o.childNodes[s+i[p]];const{props:t,children:n}=a;e.patchProps({parent:c,patches:t}),e.isNullOrUndefined(i[p+1])&&(i[p+1]=0);for(let t=0;t<n.length;t++)if(!1===e.isNullOrUndefined(n[t]))if(!0===n[t].isFragment){let r=0;n[t].children.forEach((n,l)=>{null===n&&r--,e.patch({parent:c,patches:n,index:t+l+r,level:p+1,adjustIndex:i})})}else e.patch({parent:c,patches:n[t],index:t,level:p+1,adjustIndex:i});else e.patch({parent:c,patches:n[t],index:t,level:p+1,adjustIndex:i})}}}),e.patchThePatches=(({parent:t,patches:n,index:r=0,level:l=0,adjustIndex:o=[0]})=>{e.patch({parent:t,patches:n,index:r,level:l,adjustIndex:o})}),e.assignState=((t,n)=>{if(e.isNullOrUndefined(t))return{};if("function"!=typeof t)throw"State must be function";let r=t(n);if("object"!=typeof r)throw"State should return object";if(Array.isArray(r))throw"State should not return array";return r}),e.assignAction=((t,n)=>{if(e.isNullOrUndefined(t))return{};if("function"!=typeof t)throw"Action must be function";let r=t(n);if("object"!=typeof r)throw"Action should return object";if(Array.isArray(r))throw"Action should not return array";return r}),e.assignLifecycle=((t,n)=>{if(e.isNullOrUndefined(t))return{};if("function"!=typeof t)throw"Lifecycle must be function";let r=t(n);if("object"!=typeof r)throw"Action should return object";if(Array.isArray(r))throw"Action should not return array";return r}),e.assignData=((t,n)=>{if(e.isNullOrUndefined(t))return{};if("function"!=typeof t)throw"Lifecycle must be function";let r=t(n);if("object"!=typeof r)throw"Action should return object";if(Array.isArray(r))throw"Action should not return array";return r}),e.runLifecycle=(({_lifecycle:e,name:t})=>{"function"==typeof e[t]&&e[t]()}),D.component=(({state:t,data:n,action:r,render:l,lifecycle:o,props:a})=>{if("function"!=typeof l)throw"Render should be function";return function(){let a=null,s=null,p=null,i=null,c=null,d=null,u=null,f=null;const y={set:function(e,t,n){return Reflect.set(...arguments),h(),!0}};function h(){e.runLifecycle({_lifecycle:a,name:"beforeUpdate"});let t=l({state:u,action:p,props:i,data:f}),n=e.diff({newNode:t,oldNode:d});console.log({patches:n});let r=c.parentNode,o=[...c.parentElement.childNodes].indexOf(c);e.patchThePatches({parent:r,patches:n,index:o}),"function"==typeof a.afterUpdate&&a.afterUpdate(u),d=t,e.runLifecycle({_lifecycle:a,name:"afterUpdate"})}function m(t){let n=e.createElement({node:d,parent:c});return c=n,e.runLifecycle({_lifecycle:a,name:"mount"}),n}function N(){return c}function E(){e.runLifecycle({_lifecycle:a,name:"unmount"}),a=null,s=null,p=null,i=null,c=null,d=null,u=null,f=null}function w(e){i=e,h()}return function(c){return i=c||{},s=e.assignState(t,{props:i}),u=new Proxy(s,y),p=e.assignAction(r,{props:i,state:u}),f=e.assignData(n,{state:u,props:i}),a=e.assignLifecycle(o,{state:u,data:f,action:p,props:i}),d=l({state:u,action:p,props:i,data:f}),{render:m,unmount:E,setProps:w,getContainer:N}}}}),D.createApp=(({state:t,data:n,action:r,render:l,lifecycle:o})=>(function(){let a=null,s=null,p=null,i=null,c=null,d=null,u=null;const f={set:function(e,t,n){return Reflect.set(...arguments),y(),!0}};function y(){e.runLifecycle({_lifecycle:a,name:"beforeUpdate"});let t=l({state:c,action:d}),n=e.diff({newNode:t,oldNode:i});patchThePatches({parent:p,patches:n}),i=t,e.runLifecycle({_lifecycle:a,name:"afterUpdate"})}return _props=Object.create(null),s=e.assignState(t,{props:_props}),c=new Proxy(s,f),d=e.assignAction(r,{props:null,state:c}),u=e.assignData(n,{state:c,props:_props}),a=e.assignLifecycle(o,{state:c,data:u,action:d,props:_props}),i=l({props:_props,state:c,action:d,data:u}),{mount:function(t){p=document.querySelector(t);let n=e.createElement({node:i,parent:p});e.runLifecycle({_lifecycle:a,name:"mount"}),p.appendChild(n)},setProps:function(e){_props=e,y()}}})()),D.If=(({props:e,children:t})=>{return!0==!!e.is?t[0]:{type:null,props:{},children:[]}}),D.ForEach=(({props:e,children:t})=>{const n=e.on,r=[];return n.forEach((e,n)=>{r.push(t[0](e,n))}),{type:p,props:{},children:r}}),D.Switch=(({props:e,children:t})=>{const n=e.value,r=e.strict;let l=[];for(let e=0;e<t.length&&(t[e].props.match!==n||(l=[...l,...t[e].children],!0!==r));e++);return{type:p,props:{},children:l}}),D.Case=(({props:e,children:t})=>({type:p,props:{...e,match:e.match},children:t})),D.createElement=e.h})(__internal);